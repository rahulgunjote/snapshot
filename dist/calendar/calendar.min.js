!function(){function e(e,t){e.appendChild(t)}function t(e){return parseInt(e,10)}function n(e){var n=t(e);return n===e&&!isNaN(n)&&n>=0&&6>=n}function r(e){return e instanceof Date&&!!e.getTime&&!isNaN(e.getTime())}function o(e){return e&&e.isArray?e.isArray():"[object Array]"===Object.prototype.toString.call(e)}function i(e){var t=e.split("."),n=t.shift(),r=document.createElement(n);return r[q]=t.join(" "),r}function a(e){return e.getBoundingClientRect()}function s(e,t){xtag.addClass(e,t)}function u(e,t){xtag.removeClass(e,t)}function c(e,t){return xtag.hasClass(e,t)}function l(e){return e.getUTCFullYear()}function d(e){return e.getUTCMonth()}function f(e){return e.getUTCDate()}function h(e,t){var n=e.toString(),r=new Array(t).join("0");return(r+n).substr(-t)}function p(e){return[h(l(e),4),h(d(e)+1,2),h(f(e),2)].join("-")}function v(e){if(r(e))return e;var t=W.exec(e);return t?new Date(t[1],t[2]-1,t[3]):null}function m(e){if(r(e))return e;var t=v(e);if(t)return t;var n=Date.parse(e);return isNaN(n)?null:new Date(n)}function g(e){var t;if(o(e))t=e.slice(0);else{if(r(e))return[e];if(!("string"==typeof e&&e.length>0))return null;try{if(t=JSON.parse(e),!o(t))return console.warn("invalid list of ranges",e),null}catch(n){var i=m(e);return i?[i]:(console.warn("unable to parse",e,"as JSON or single date"),null)}}for(var a=0;a<t.length;a++){var s=t[a];if(!r(s))if("string"==typeof s){var u=m(s);if(!u)return console.warn("unable to parse date",s),null;t[a]=u}else{if(!o(s)||2!==s.length)return console.warn("invalid range value: ",s),null;var c=m(s[0]);if(!c)return console.warn("unable to parse start date",s[0],"from range",s),null;var l=m(s[1]);if(!l)return console.warn("unable to parse end date",s[1],"from range",s),null;if(c.valueOf()>l.valueOf())return console.warn("invalid range",s,": start date is after end date"),null;t[a]=[c,l]}}return t}function b(e,t,n,r){return void 0===t&&(t=l(e)),void 0===n&&(n=d(e)),void 0===r&&(r=f(e)),new Date(t,n,r)}function y(e,t,n,r){return b(e,l(e)+t,d(e)+n,f(e)+r)}function _(e,r){for(r=t(r),n(r)||(r=0);e.getUTCDay()!==r;)e=N(e);return e}function w(e,r){for(r=t(r),n(r)||(r=6);e.getUTCDay()!==r;)e=O(e);return e}function E(e){for(;f(e)>1;)e=N(e);return e}function x(e){return N(y(e,0,1,0))}function O(e){return y(e,0,0,1)}function N(e){return y(e,0,0,-1)}function A(e,t){if(t){t=void 0===t.length?[t]:t;var n=!1;return t.forEach(function(t){2===t.length?M(t[0],t[1],e)&&(n=!0):p(t)===p(e)&&(n=!0)}),n}}function M(e,t,n){return p(e)<=p(n)&&p(n)<=p(t)}function C(e){e.sort(function(e,t){var n=r(e)?e:e[0],o=r(t)?t:t[0];return n.valueOf()-o.valueOf()})}function T(t){var n=i("div.controls"),r=i("span.prev"),o=i("span.next");return r.innerHTML=t.prev,o.innerHTML=t.next,e(n,r),e(n,o),n}function L(e){var t=this;e=e||{},t._span=e.span||1,t._multiple=e.multiple||!1,t._viewDate=t._getSanitizedViewDate(e.view,e.chosen),t._chosenRanges=t._getSanitizedChosenRanges(e.chosen,e.view),t._firstWeekdayNum=e.firstWeekdayNum||0,t._el=i("div.calendar"),t._labels=U(),t._customRenderFn=null,t._renderRecursionFlag=!1,t.render(!0)}function k(e){e=e.slice(0),C(e);for(var t=[],n=0;n<e.length;n++){var o,i,a,s,u=e[n],c=t.length>0?t[t.length-1]:null;if(r(u)?o=i=u:(o=u[0],i=u[1]),u=A(o,i)?o:[o,i],r(c))a=s=c;else{if(!c){t.push(u);continue}a=c[0],s=c[1]}if(A(o,[c])||A(N(o),[c])){var l=a.valueOf()<o.valueOf()?a:o,d=s.valueOf()>i.valueOf()?s:i,f=A(l,d)?l:[l,d];t[t.length-1]=f}else t.push(u)}return t}function S(e,t){var n,r=t.getAttribute("data-date"),o=m(r);c(t,V)?(e.xtag.dragType=I,n="datetoggleoff"):(e.xtag.dragType=H,n="datetoggleon"),e.xtag.dragStartEl=t,e.xtag.dragAllowTap=!0,e.noToggle||xtag.fireEvent(e,n,{detail:{date:o,iso:r}}),e.setAttribute("active",!0),t.setAttribute("active",!0)}function D(e,t){var n=t.getAttribute("data-date"),r=m(n);t!==e.xtag.dragStartEl&&(e.xtag.dragAllowTap=!1),e.noToggle||(e.xtag.dragType!==H||c(t,V)?e.xtag.dragType===I&&c(t,V)&&xtag.fireEvent(e,"datetoggleoff",{detail:{date:r,iso:n}}):xtag.fireEvent(e,"datetoggleon",{detail:{date:r,iso:n}})),e.xtag.dragType&&t.setAttribute("active",!0)}function j(){for(var e=xtag.query(document,"x-calendar"),t=0;t<e.length;t++){var n=e[t];n.xtag.dragType=null,n.xtag.dragStartEl=null,n.xtag.dragAllowTap=!1,n.removeAttribute("active")}for(var r=xtag.query(document,"x-calendar .day[active]"),o=0;o<r.length;o++)r[o].removeAttribute("active")}function R(e,t,n){return n.left<=e&&e<=n.right&&n.top<=t&&t<=n.bottom}var F=0,U=function(){return{prev:"<",next:">",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}},P=new Date;P.setHours(0),P.setMinutes(0),P.setSeconds(0),P.setMilliseconds(0);var H="add",I="remove",V="chosen",q="className",W=/(\d{4})[^\d]?(\d{2})[^\d]?(\d{2})/,z=L.prototype;z.makeMonth=function(t){if(!r(t))throw"Invalid view date!";var n=this.firstWeekdayNum,o=this.chosen,a=this.labels,u=d(t),c=_(E(t),n),h=i("div.month"),v=i("div.month-label");v.textContent=a.months[u]+" "+l(t),e(h,v);for(var m=i("div.weekday-labels"),g=0;7>g;g++){var b=(n+g)%7,y=i("span.weekday-label");y.textContent=a.weekdays[b],e(m,y)}e(h,m);for(var w=i("div.week"),x=c,N=!1;!N;){var M=i("span.day");M.setAttribute("data-date",p(x)),M.textContent=f(x),d(x)!==u&&s(M,"badmonth"),A(x,o)&&s(M,V),A(x,P)&&s(M,"today"),e(w,M),x=O(x),x.getUTCDay()===n&&(e(h,w),w=i("div.week"),N=d(x)>u||d(x)<u&&l(x)>l(c))}return h},z._getSanitizedViewDate=function(e,t){if(t=void 0===t?this.chosen:t,r(e))return e;if(r(t))return t;if(o(t)&&t.length>0){var n=t[0];return r(n)?n:n[0]}return P},z._getSanitizedChosenRanges=function(e,t){t=void 0===t?this.view:t;var n;n=r(e)?[e]:o(e)?e:null!==e&&void 0!==e&&t?[t]:[];var i=k(n);if(!this.multiple&&i.length>0){var a=i[0];return r(a)?[a]:[a[0]]}return i},z.addDate=function(e,t){r(e)&&(t?(this.chosen.push(e),this.chosen=this.chosen):this.chosen=[e])},z.removeDate=function(e){if(r(e))for(var t=this.chosen.slice(0),n=0;n<t.length;n++){var i=t[n];if(A(e,[i])){if(t.splice(n,1),o(i)){var a=i[0],s=i[1],u=N(e),c=O(e);A(u,[i])&&t.push([a,u]),A(c,[i])&&t.push([c,s])}this.chosen=k(t);break}}},z.hasChosenDate=function(e){return A(e,this._chosenRanges)},z.hasVisibleDate=function(e,t){var n=t?this.firstVisibleMonth:this.firstVisibleDate,r=t?x(this.lastVisibleMonth):this.lastVisibleDate;return A(e,[[n,r]])},z.render=function(t){var n,r=this._span;if(t){var o,i=xtag.query(this.el,".day");for(n=0;n<i.length;n++)if(o=i[n],o.hasAttribute("data-date")){var a=o.getAttribute("data-date"),c=v(a);c&&(A(c,this._chosenRanges)?s(o,V):u(o,V),A(c,[P])?s(o,"today"):u(o,"today"))}}else{this.el.innerHTML="";var l=this.firstVisibleMonth;for(n=0;r>n;n++)e(this.el,this.makeMonth(l)),l=y(l,0,1,0)}this._callCustomRenderer()},z._callCustomRenderer=function(){if(this._customRenderFn){if(this._renderRecursionFlag)throw"Error: customRenderFn causes recursive loop of rendering calendar; make sure your custom rendering function doesn't modify attributes of the x-calendar that would require a re-render!";for(var e=xtag.query(this.el,".day"),t=0;t<e.length;t++){var n=e[t],r=n.getAttribute("data-date"),o=v(r);this._renderRecursionFlag=!0,this._customRenderFn(n,o?o:null,r),this._renderRecursionFlag=!1}}},Object.defineProperties(z,{el:{get:function(){return this._el}},multiple:{get:function(){return this._multiple},set:function(e){this._multiple=e,this.chosen=this._getSanitizedChosenRanges(this.chosen),this.render(!0)}},span:{get:function(){return this._span},set:function(e){var n=t(e);this._span=!isNaN(n)&&n>=0?n:0,this.render(!1)}},view:{attribute:{},get:function(){return this._viewDate},set:function(e){var t=this._getSanitizedViewDate(e),n=this._viewDate;this._viewDate=t,this.render(d(n)===d(t)&&l(n)===l(t))}},chosen:{get:function(){return this._chosenRanges},set:function(e){this._chosenRanges=this._getSanitizedChosenRanges(e),this.render(!0)}},firstWeekdayNum:{get:function(){return this._firstWeekdayNum},set:function(e){e=t(e),n(e)||(e=0),this._firstWeekdayNum=e,this.render(!1)}},lastWeekdayNum:{get:function(){return(this._firstWeekdayNum+6)%7}},customRenderFn:{get:function(){return this._customRenderFn},set:function(e){this._customRenderFn=e,this.render(!0)}},chosenString:{get:function(){if(this.multiple){for(var e=this.chosen.slice(0),t=0;t<e.length;t++){var n=e[t];e[t]=r(n)?p(n):[p(n[0]),p(n[1])]}return JSON.stringify(e)}return this.chosen.length>0?p(this.chosen[0]):""}},firstVisibleMonth:{get:function(){return E(y(this.view,0,-Math.floor(this.span/2),0))}},lastVisibleMonth:{get:function(){return y(this.firstVisibleMonth,0,Math.max(0,this.span-1),0)}},firstVisibleDate:{get:function(){return _(this.firstVisibleMonth,this.firstWeekdayNum)}},lastVisibleDate:{get:function(){return w(x(this.lastVisibleMonth),this.lastWeekdayNum)}},labels:{get:function(){return this._labels},set:function(e){var t=this.labels;for(var n in t)if(n in e){var r=this._labels[n],i=e[n];if(o(r)){if(!o(i)||r.length!==i.length)throw"invalid label given for '"+n+"': expected array of "+r.length+" labels, got "+JSON.stringify(i);i=i.slice(0);for(var a=0;a<i.length;a++)i[a]=i[a].toString?i[a].toString():String(i[a])}else i=String(i);t[n]=i}this.render(!1)}}});var J=null,G=null;xtag.register("x-calendar",{lifecycle:{created:function(){this.innerHTML="";var t=this.getAttribute("chosen");this.xtag.calObj=new L({span:this.getAttribute("span"),view:m(this.getAttribute("view")),chosen:g(t),multiple:this.hasAttribute("multiple"),firstWeekdayNum:this.getAttribute("first-weekday-num")}),e(this,this.xtag.calObj.el),this.xtag.calControls=null,this.xtag.dragType=null,this.xtag.dragStartEl=null,this.xtag.dragAllowTap=!1},inserted:function(){J||(J=xtag.addEvent(document,"mouseup",j)),G||(G=xtag.addEvent(document,"touchend",j)),this.render(!1)},removed:function(){0===xtag.query(document,"x-calendar").length&&(J&&(xtag.removeEvent(document,"mouseup",J),J=null),G&&(xtag.removeEvent(document,"touchend",G),G=null))}},events:{"tap:delegate(.next)":function(e){var t=e.currentTarget;t.nextMonth(),xtag.fireEvent(t,"nextmonth")},"tap:delegate(.prev)":function(e){var t=e.currentTarget;t.prevMonth(),xtag.fireEvent(t,"prevmonth")},"tapstart:delegate(.day)":function(e){(e.touches||!e.button||e.button===F)&&(e.preventDefault(),S(e.currentTarget,this))},touchmove:function(e){if(e.touches&&e.touches.length>0){var t=e.currentTarget;if(t.xtag.dragType)for(var n=e.touches[0],r=xtag.query(t,".day"),o=0;o<r.length;o++){var i=r[o];R(n.pageX,n.pageY,a(i))?D(t,i):i.removeAttribute("active")}}},"mouseover:delegate(.day)":function(e){var t=e.currentTarget,n=this;D(t,n)},"mouseout:delegate(.day)":function(){var e=this;e.removeAttribute("active")},"tapend:delegate(.day)":function(e){var t=e.currentTarget;if(t.xtag.dragAllowTap){var n=this,r=n.getAttribute("data-date"),o=m(r);xtag.fireEvent(t,"datetap",{detail:{date:o,iso:r}})}},datetoggleon:function(e){var t=this;t.toggleDateOn(e.detail.date,t.multiple)},datetoggleoff:function(e){var t=this;t.toggleDateOff(e.detail.date)}},accessors:{controls:{attribute:{"boolean":!0},set:function(t){t&&!this.xtag.calControls&&(this.xtag.calControls=T(this.xtag.calObj.labels),e(this,this.xtag.calControls))}},multiple:{attribute:{"boolean":!0},get:function(){return this.xtag.calObj.multiple},set:function(e){this.xtag.calObj.multiple=e,this.chosen=this.chosen}},span:{attribute:{},get:function(){return this.xtag.calObj.span},set:function(e){this.xtag.calObj.span=e}},view:{attribute:{},get:function(){return this.xtag.calObj.view},set:function(e){var t=m(e);t&&(this.xtag.calObj.view=t)}},chosen:{attribute:{skip:!0},get:function(){var e=this.xtag.calObj.chosen;if(this.multiple)return this.xtag.calObj.chosen;if(e.length>0){var t=e[0];return r(t)?t:t[0]}return null},set:function(e){var t=this.multiple?g(e):m(e);this.xtag.calObj.chosen=t?t:null,this.xtag.calObj.chosenString?this.setAttribute("chosen",this.xtag.calObj.chosenString):this.removeAttribute("chosen")}},firstWeekdayNum:{attribute:{name:"first-weekday-num"},set:function(e){this.xtag.calObj.firstWeekdayNum=e}},noToggle:{attribute:{"boolean":!0,name:"notoggle"},set:function(e){e&&(this.chosen=null)}},firstVisibleMonth:{get:function(){return this.xtag.calObj.firstVisibleMonth}},lastVisibleMonth:{get:function(){return this.xtag.calObj.lastVisibleMonth}},firstVisibleDate:{get:function(){return this.xtag.calObj.firstVisibleDate}},lastVisibleDate:{get:function(){return this.xtag.calObj.lastVisibleDate}},customRenderFn:{get:function(){return this.xtag.calObj.customRenderFn},set:function(e){this.xtag.calObj.customRenderFn=e}},labels:{get:function(){return JSON.parse(JSON.stringify(this.xtag.calObj.labels))},set:function(e){this.xtag.calObj.labels=e;var t=this.xtag.calObj.labels,n=this.querySelector(".controls > .prev");n&&(n.textContent=t.prev);var r=this.querySelector(".controls > .next");r&&(r.textContent=t.next)}}},methods:{render:function(e){this.xtag.calObj.render(e)},prevMonth:function(){var e=this.xtag.calObj;e.view=y(e.view,0,-1,0)},nextMonth:function(){var e=this.xtag.calObj;e.view=y(e.view,0,1,0)},toggleDateOn:function(e,t){this.xtag.calObj.addDate(e,t),this.chosen=this.chosen},toggleDateOff:function(e){this.xtag.calObj.removeDate(e),this.chosen=this.chosen},toggleDate:function(e,t){this.xtag.calObj.hasChosenDate(e)?this.toggleDateOff(e):this.toggleDateOn(e,t)},hasVisibleDate:function(e,t){return this.xtag.calObj.hasVisibleDate(e,t)}}})}();